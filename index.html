<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario de Actividades del Roleplay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f3f4f6; /* text-gray-200 */
        }
        .gradient-text {
            background: linear-gradient(to right, #4f46e5, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.75);
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .timeline-item {
            cursor: pointer;
            transition: filter 0.2s ease;
        }
        .timeline-item:hover {
            filter: brightness(1.25);
        }
        /* Custom Scrollbar for Webkit browsers */
        .custom-scrollbar::-webkit-scrollbar {
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937; /* bg-gray-800 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4f46e5; /* bg-indigo-600 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6366f1; /* bg-indigo-500 */
        }
        .custom-scrollbar::-webkit-scrollbar-corner {
            background: transparent;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight gradient-text">Centro de Mando de Actividades</h1>
            <p class="mt-2 text-lg text-gray-400">Tu calendario y analítica para dominar el roleplay.</p>
        </header>

        <!-- Time & Analytics Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Time Clocks -->
            <div class="lg:col-span-1 bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
                <h2 class="text-2xl font-bold mb-4 text-white">Relojes Sincronizados</h2>
                <div class="space-y-4">
                    <div class="p-4 bg-gray-700 rounded-lg">
                        <p class="text-sm font-medium text-indigo-400">HORA LOCAL (TU PC)</p>
                        <p id="local-time" class="text-3xl font-bold text-white">--:--:--</p>
                    </div>
                    <div class="p-4 bg-gray-700 rounded-lg">
                        <p class="text-sm font-medium text-pink-400">HORA DEL ROLEPLAY (HUB)</p>
                        <p id="hub-time" class="text-3xl font-bold text-white">--:--:--</p>
                    </div>
                </div>
            </div>

            <!-- Analytics -->
            <div class="lg:col-span-2 bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
                <h2 class="text-2xl font-bold mb-4 text-white">Análisis Semanal</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="best-days" class="bg-gray-700 p-4 rounded-lg">
                        <!-- JS generated -->
                    </div>
                    <div id="calmest-days" class="bg-gray-700 p-4 rounded-lg">
                         <!-- JS generated -->
                    </div>
                    <div id="next-advanced-traffic" class="bg-gray-700 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg mb-2 text-teal-300">Próximo Tráfico Avanzado</h3>
                        <p class="text-xl font-bold text-white">Calculando...</p>
                    </div>
                    <div id="next-multiple-traffic" class="bg-gray-700 p-4 rounded-lg">
                        <h3 class="font-semibold text-lg mb-2 text-rose-300">Próximo Tráfico Múltiple</h3>
                        <p class="text-xl font-bold text-white">Calculando...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly Calendar -->
        <div id="calendar-container" class="space-y-8">
            <!-- Day columns will be generated by JS -->
        </div>

    </div>

    <!-- Modal -->
    <div id="activity-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden opacity-0">
        <div class="modal-content bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md border border-gray-600 transform scale-95">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="modal-title" class="text-2xl font-bold text-white"></h2>
                    <button onclick="hideActivityModal()" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <img id="modal-image" src="https://placehold.co/600x400/1f2937/374151?text=Actividad" alt="Imagen de la actividad" class="w-full h-48 object-cover rounded-lg mb-4">
                <div>
                    <h3 class="font-semibold text-lg text-indigo-300 mb-2">Puntos</h3>
                    <p id="modal-points" class="text-white text-lg font-bold"></p>
                </div>
                <div class="mt-4">
                    <h3 class="font-semibold text-lg text-pink-300 mb-2">Horario Completo</h3>
                    <ul id="modal-schedule" class="text-gray-300 space-y-2"></ul>
                </div>
            </div>
            <div class="bg-gray-900 px-6 py-3 rounded-b-2xl text-right">
                 <button onclick="hideActivityModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Cerrar</button>
            </div>
        </div>
    </div>


    <script>
        // --- DATA ---
        // Days: 1=Lunes, 2=Martes, 3=Miércoles, 4=Jueves, 5=Viernes, 6=Sábado, 7=Domingo
        const activities = [
            { name: "Misión de trafico ilegal", days: [1, 4, 6], times: [{s:9, e:12}, {s:17, e:20}, {s:22, e:23}], points: 2, isNew: false, color: 'bg-red-700' },
            { name: "Robo a negocios", days: [3, 5, 6], times: [{s:0, e:11}, {s:12, e:23}], points: 7, isNew: false, color: 'bg-amber-600' },
            { name: "Lancha encallada", days: [2, 5, 6, 7], times: [{s:2, e:4}, {s:16, e:18}, {s:18, e:20}, {s:20, e:22}], points: 5, isNew: false, color: 'bg-sky-600' },
            { name: "Elaboración de meta (Día 1)", days: [1], times: [{s:7, e:23}], points: 31, isNew: false, color: 'bg-purple-600' },
            { name: "Elaboración de meta (Día 2)", days: [3], times: [{s:7, e:23}], points: 32, isNew: false, color: 'bg-purple-600' },
            { name: "Elaboración de meta (Día 3)", days: [5], times: [{s:7, e:23}], points: 31, isNew: false, color: 'bg-purple-600' },
            { name: "Dia de recompensa (Meta)", days: [7], times: [{s:7, e:23}], points: 100, isNew: false, color: 'bg-purple-700' },
            { name: "Reparto de químicos", days: [1, 4], times: [{s:14, e:20}], points: 10, isNew: false, color: 'bg-green-600' },
            { name: "Reparto aéreo", days: [2, 5], times: [{s:9, e:12}, {s:17, e:20}, {s:22, e:23}], points: 7, isNew: false, color: 'bg-green-600' },
            { name: "Búsqueda de contenedores", days: [3, 4, 6, 7], times: [{s:2, e:4}, {s:18, e:20}, {s:20, e:22}, {s:22, e:23}], points: 10, isNew: false, color: 'bg-sky-600' },
            { name: "Misión de trafico ilegal (Avanzado)", days: [2, 3, 7], times: [{s:7, e:10}, {s:14, e:20}, {s:21, e:22}], points: 1, isNew: false, color: 'bg-red-700' },
            { name: "Arrasa con sus vehículos", days: [2, 4, 6, 7], times: [{s:18, e:19}, {s:21, e:22}], points: 10, isNew: true, color: 'bg-orange-500' },
            { name: "Mantenimiento de maquinas de lavado", days: [5], times: [{s:19, e:20}], points: 20, isNew: true, color: 'bg-cyan-600' },
            { name: "Trafico múltiple", days: [2, 6], times: [{s:21, e:22}], points: 5, isNew: true, color: 'bg-red-700' },
            { name: "Trafico de órganos", days: [2], times: [{s:19, e:21}], points: 10, isNew: true, color: 'bg-red-700' },
            { name: "Mantenimiento de secuestrado", days: [1], times: [{s:16, e:23}], points: 10, isNew: true, color: 'bg-rose-600' },
            { name: "Busqueda acuatica", days: [1, 6, 7], times: [{s:20, e:21}], points: 5, isNew: true, color: 'bg-sky-600' },
            { name: "Comunicado Interno", days: [1, 2, 3, 4, 5, 6, 7], times: [{s:0, e:23}], points: '?', isNew: true, color: 'bg-slate-500' },
        ];
        const dayNames = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"];

        // --- TIME MANAGEMENT ---
        function updateClocks() {
            const localTimeEl = document.getElementById('local-time');
            const hubTimeEl = document.getElementById('hub-time');
            if (!localTimeEl || !hubTimeEl) return;

            const now = new Date();
            const hubTime = new Date(now.getTime() - (2 * 60 * 60 * 1000));
            localTimeEl.textContent = now.toLocaleTimeString('es-ES');
            hubTimeEl.textContent = hubTime.toLocaleTimeString('es-ES', { timeZone: 'Europe/Madrid' });
        }

        // --- UI GENERATION ---
        function generateContent() {
            const calendarContainer = document.getElementById('calendar-container');
            const bestDaysEl = document.getElementById('best-days');
            const calmestDaysEl = document.getElementById('calmest-days');
            
            bestDaysEl.innerHTML = '<h3 class="font-semibold text-lg mb-2 text-indigo-300">Día con Más Puntos</h3>';
            calmestDaysEl.innerHTML = '<h3 class="font-semibold text-lg mb-2 text-pink-300">Día con Menos Actividades</h3>';

            let dailyActivityCount = Array(7).fill(0);
            let dailyPoints = Array(7).fill(0);

            activities.forEach(activity => {
                activity.days.forEach(dayIndex => {
                    dailyActivityCount[dayIndex - 1]++;
                    if(typeof activity.points === 'number') {
                        dailyPoints[dayIndex - 1] += activity.points;
                    }
                });
            });

            const maxPoints = Math.max(...dailyPoints);
            const bestDays = dayNames.filter((_, i) => dailyPoints[i] === maxPoints);
            bestDaysEl.innerHTML += `<p class="text-xl font-bold text-white">${bestDays.join(', ')}</p><p class="text-sm text-indigo-300">con <span class="font-bold">${maxPoints}</span> puntos</p>`;

            const minActivities = Math.min(...dailyActivityCount);
            const calmestDays = dayNames.filter((_, i) => dailyActivityCount[i] === minActivities);
            calmestDaysEl.innerHTML += `<p class="text-xl font-bold text-white">${calmestDays.join(', ')}</p><p class="text-sm text-pink-300">con <span class="font-bold">${minActivities}</span> actividades</p>`;

            calendarContainer.innerHTML = dayNames.map((name, index) => {
                const dayIndex = index + 1;
                
                // Layout algorithm to assign tracks (rows) to non-overlapping activities
                const tracks = []; // Array of arrays of slots
                const allSlots = [];
                activities.filter(act => act.days.includes(dayIndex)).forEach(activity => {
                    activity.times.forEach(timeSlot => {
                        allSlots.push({ ...timeSlot, activity });
                    });
                });

                allSlots.sort((a, b) => {
                    if (a.s !== b.s) return a.s - b.s;
                    return (b.e - b.s) - (a.e - a.s);
                });

                allSlots.forEach(slot => {
                    let placed = false;
                    for (let i = 0; i < tracks.length; i++) {
                        const track = tracks[i];
                        const hasOverlap = track.some(existing => slot.s < existing.e && slot.e > existing.s);
                        if (!hasOverlap) {
                            track.push(slot);
                            placed = true;
                            break;
                        }
                    }
                    if (!placed) {
                        tracks.push([slot]);
                    }
                });

                const timelineContentHTML = tracks.map(track => {
                    const trackItemsHTML = track.map(slot => {
                        const start = slot.s + 1;
                        const duration = slot.e - slot.s;
                        const pointsText = slot.activity.points === '?' ? '?' : `${slot.activity.points} pts`;
                        const newRing = slot.activity.isNew ? 'ring-2 ring-offset-2 ring-pink-500 ring-offset-gray-800' : '';
                        return `
                            <div onclick="showActivityModal('${slot.activity.name}')"
                                 class="timeline-item text-white text-xs font-semibold p-2 rounded ${slot.activity.color} ${newRing} flex items-center justify-center"
                                 style="grid-column: ${start} / span ${duration};">
                                <span>${slot.activity.name} (${pointsText})</span>
                            </div>
                        `;
                    }).join('');
                    return `<div class="grid grid-cols-24 gap-1 h-12 items-center">${trackItemsHTML}</div>`;
                }).join('');

                let hourLabelsHTML = '';
                for (let hour = 0; hour < 24; hour++) {
                    hourLabelsHTML += `<div class="w-[100px] text-center text-xs text-gray-400 pt-1">${String(hour).padStart(2,'0')}:00</div>`;
                }

                return `
                    <div id="day-container-${dayIndex}" class="bg-gray-800 p-4 rounded-2xl border border-gray-700">
                        <h3 class="font-bold text-2xl mb-4 text-center text-white">${name}</h3>
                        <div class="overflow-x-auto custom-scrollbar">
                            <div class="w-[2400px]">
                                <div class="space-y-1">
                                    ${timelineContentHTML}
                                </div>
                                <div class="flex border-t border-gray-700 mt-1">
                                    ${hourLabelsHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCountdowns() {
            const advTrafficEl = document.querySelector('#next-advanced-traffic p');
            const multiTrafficEl = document.querySelector('#next-multiple-traffic p');
            if (!advTrafficEl || !multiTrafficEl) return;

            // Use HUB time for calculations. Assuming HUB is UTC for this logic.
            const now = new Date();

            const findNextOccurrence = (activityName) => {
                const activity = activities.find(a => a.name === activityName);
                if (!activity) return null;

                let nextDate = null;

                for (let i = 0; i < 7; i++) {
                    const checkDate = new Date(now);
                    checkDate.setUTCDate(now.getUTCDate() + i);
                    const dayOfWeek = (checkDate.getUTCDay() === 0) ? 7 : checkDate.getUTCDay();

                    if (activity.days.includes(dayOfWeek)) {
                        for (const time of activity.times) {
                            const potentialNextDate = new Date(checkDate);
                            potentialNextDate.setUTCHours(time.s, 0, 0, 0);

                            if (potentialNextDate > now) {
                                if (!nextDate || potentialNextDate < nextDate) {
                                    nextDate = potentialNextDate;
                                }
                            }
                        }
                    }
                }
                return nextDate;
            };

            const formatCountdown = (targetDate) => {
                if (!targetDate) return "No programado";
                const diff = targetDate - now;
                if (diff <= 0) return "En curso o finalizado";

                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);

                return `${d}d ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m ${String(s).padStart(2,'0')}s`;
            };

            const nextAdv = findNextOccurrence("Misión de trafico ilegal (Avanzado)");
            advTrafficEl.textContent = formatCountdown(nextAdv);

            const nextMulti = findNextOccurrence("Trafico múltiple");
            multiTrafficEl.textContent = formatCountdown(nextMulti);
        }

        // --- MODAL MANAGEMENT ---
        function showActivityModal(activityName) {
            const activity = activities.find(act => act.name === activityName);
            if (!activity) return;

            document.getElementById('modal-title').textContent = activity.name;
            document.getElementById('modal-points').textContent = activity.points === '?' ? 'Puntos variables según la actividad que toque.' : `${activity.points} Puntos`;
            
            const scheduleList = document.getElementById('modal-schedule');
            scheduleList.innerHTML = activity.days.map(dayIndex => {
                const day = dayNames[dayIndex - 1];
                const timeRanges = activity.times.map(t => `${String(t.s).padStart(2,'0')}:00 - ${String(t.e).padStart(2,'0')}:00`).join(', ');
                return `<li><button onclick="scrollToDay(${dayIndex})" class="w-full text-left p-2 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors"><span class="font-semibold text-white">${day}:</span> ${timeRanges}</button></li>`;
            }).join('');

            const modal = document.getElementById('activity-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.firstElementChild.classList.remove('scale-95');
                modal.firstElementChild.classList.add('scale-100');
            }, 10);
        }

        function hideActivityModal() {
            const modal = document.getElementById('activity-modal');
            modal.classList.add('opacity-0');
            modal.firstElementChild.classList.add('scale-95');
            modal.firstElementChild.classList.remove('scale-100');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function scrollToDay(dayIndex) {
            hideActivityModal();
            const dayElement = document.getElementById(`day-container-${dayIndex}`);
            if(dayElement) {
                setTimeout(() => {
                    dayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300); // Wait for modal to finish hiding
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            updateClocks();
            updateCountdowns();
            setInterval(() => {
                updateClocks();
                updateCountdowns();
            }, 1000);
            generateContent();
            
            const modalElement = document.getElementById('activity-modal');
            modalElement.addEventListener('click', function(e) {
                if(e.target === modalElement) {
                    hideActivityModal();
                }
            });
        });
    </script>

</body>
</html>
